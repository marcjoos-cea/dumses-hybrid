# This is DUMSES - hybrid version

Copyrights 2013-2021, CEA, Marc Joos<marc.joos@cea.fr>, Sébastien Fromang, Patrick Hennebelle, Romain Teyssier
This software is distributed under the CeCILL-A & GNU/GPL licences (see <http://www.cecill.info/licences/Licence_CeCILL_V2.1-en.html> and <http://www.gnu.org/licenses/>)

Main Contributors to the code:
 - Code architecture      : Marc Joos, Sébastien Fromang, Patrick Hennebelle, Romain Teyssier
 - MPI parallelization    : Sébastien Fromang, Patrick Hennebelle, Romain Teyssier
 - OpenMP parallelization : Marc Joos
 - OpenACC parallelization: Marc Joos, Damien Merret, Laëtitia Anton, Clément Fontenaille, Rémy Dubois
 - MHD                    : Sébastien Fromang, Patrick Hennebelle, Romain Teyssier
 - Parallel I/O           : Marc Joos, Pierre Kestener

DUMSES is a 3D MPI/OpenMP & MPI/OpenACC Eulerian second-order Godunov (magneto)hydrodynamic simulation code in cartesian, spherical and cylindrical coordinates.


## CONFIGURATION/COMPILATION

Configuration script from the previous versions was removed. For the moment you can use an example Makefile from makefiles/ directory.

Options that can be modified at compile time are:
 - `NDIM`    : number of dimensions of the problem (1,2,3)
 - `ISO`     : isothermal computation (0,1)
 - `GEOM`    : geometry of the problem (cartesian, cylindrical, spherical)
 - `MPI`     : MPI parallelization (0, 1)
 - `HDF5`    : HDF5 libary usage (0, 1)
 - `PHDF5`   : Parallel HDF5 library usage (0, 1)
 - `PNCDF`   : Parallel NetCDF library usage (0, 1)
 - `PGIFC`   : PGI or Nvidia compiler usage (0, 1)
 - `OACC`    : OpenACC parallization (0, 1)
 - `RDMA`    : GPU-Direct RDMA usage with OpenACC (0, 1)
 - `NCCL`    : NCCL communication (under development) (0, 1)
 - `PROBLEM` : path to the problem (`src/problem/<problem>`)

If you want to run a version with additional timer, you could use the Python preprocessor:

```
$ python3
import sys
sys.path.append('utils/pyutils/')
from preproc import FileTree
tree = FileTree('./src')
tree.processAllFiles()

$ cd tmp/
$ cp ../makefiles/Makefile.<version>; make
```

## RUNNING THE CODE

Problems can be found in src/problem/. Please select a problem in your Makefile, and then copy the input file in your execution directory to run the code.


## ANALYZING THE RESULTS

In utils/dumpy/ you will find a small Python package to read DUMSES data.


## TESTING THE CODE

A test suite can be run in utils/test/ by the test.py script. You just have to run

python test.py

It can take several minutes to run. It produces a PDF file in utils/test/fig/ summarizing the results and comparing them to a reference test suite execution.


## DOCUMENTATION

Documentation of the code can be generated by running:
```
$ doxygen doc/Doxyfile
```

You can then access it with your favorite browser:
```
$ <browser> doc/html/index.html
```

User manual can be generated by running:
```
$ pdflatex doc/manual/manual.tex
```
or, if you have minted installed:
```
$ pdflatex -shell-escape doc/manual/manual.tex
```
